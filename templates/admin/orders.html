{% extends "base.html" %}
{% block title %}Заказы{% endblock %}

{% block content %}
<style>
.order-card {
  background: #fff;
  border-radius: 12px;
  padding: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}
.order-card ul {
  margin-bottom: 0.6rem;
}
.order-actions .btn {
  font-size: 0.85rem;
  height: 34px;
  padding: 0 0.6rem;
  border-radius: 8px;
}
.price-convert {
  font-size: 0.85rem;
  color: #6b7280;
}
</style>

<div class="container mt-3">
  <h3 class="text-center mb-4"><i class="fas fa-list"></i> Заказы</h3>

  {% if orders %}
    {% for order in orders %}
      <div class="order-card">
        <div class="d-flex justify-content-between mb-1">
          <div><strong>Заказ #{{ order.id }}</strong> — {{ order.user.username }}</div>
          <small class="text-muted">{{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
        </div>

        <ul class="list-unstyled small mb-2">
          {% for item in order.items %}
          <li>
            <i class="fas fa-box text-secondary me-1"></i>
            {{ item.product.name }} × {{ item.quantity }} —
            <span class="text-success">
              {{ "{:,.2f}".format(item.product.price * item.quantity) }} $
            </span>
            <span class="price-convert">
              (≈ {{ "{:,.0f}".format(item.product.price * item.quantity * kurs) }} UZS)
            </span>
          </li>
          {% endfor %}
        </ul>

        <div class="d-flex justify-content-between align-items-center order-actions flex-wrap gap-2">
          {% set total = namespace(value=0) %}
          {% for item in order.items %}
            {% set total.value = total.value + (item.product.price * item.quantity) %}
          {% endfor %}
          <span class="fw-bold text-dark">
            Итого: {{ "{:,.2f}".format(total.value) }} $
            <small class="text-muted">≈ {{ "{:,.0f}".format(total.value * kurs) }} UZS</small>
          </span>

          <div class="d-flex gap-2">
            {% if order.status == 'pending' %}
              <a href="{{ url_for('update_order', order_id=order.id, status='confirmed') }}" class="btn btn-sm btn-outline-success">
                <i class="fas fa-check"></i> Подтвердить
              </a>
              <a href="{{ url_for('update_order', order_id=order.id, status='cancelled') }}" class="btn btn-sm btn-outline-danger">
                <i class="fas fa-times"></i> Отменить
              </a>
            {% elif order.status == 'confirmed' %}
              <span class="badge bg-success d-flex align-items-center">
                <i class="fas fa-check-circle me-1"></i> Подтвержден
              </span>
              <a href="{{ url_for('print_order', order_id=order.id) }}" target="_blank" class="btn btn-sm btn-dark">
                <i class="fas fa-print"></i> Печать чека
              </a>
            {% elif order.status == 'cancelled' %}
              <span class="badge bg-danger d-flex align-items-center">
                <i class="fas fa-ban me-1"></i> Отменен
              </span>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="text-center text-muted py-5">
      <i class="fas fa-inbox fa-3x mb-3"></i>
      <p>Заказов пока нет</p>
    </div>
  {% endif %}
</div>
{% endblock %}
